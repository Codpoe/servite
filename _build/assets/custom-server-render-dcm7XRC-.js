import{j as s}from"./jsx-runtime-OjB1YB6s.js";import{u as e}from"./index-Crl2ozBJ.js";const c={commitTime:1727681315},d=[{id:"自定义服务端渲染",text:"自定义服务端渲染",depth:1}];function r(l){const i={code:"code",h1:"h1",li:"li",p:"p",pre:"pre",span:"span",ul:"ul",...e(),...l.components};return s.jsxs(s.Fragment,{children:[s.jsx(i.h1,{id:"自定义服务端渲染",children:"自定义服务端渲染"}),`
`,s.jsxs(i.p,{children:["默认情况下，servite 会直接调用 React 的 ",s.jsx(i.code,{children:"renderToString"}),` 方法来渲染应用，
这已经能适配很多场景了。然而如果你使用了 `,s.jsx(i.code,{children:"styled-jsx"})," 或 ",s.jsx(i.code,{children:"styled-components"}),` 之类的
CSS-in-JS 样式方案，一般这些方案都会提供特定的工具让你在 SSR 时收集样式，然后将这些样式
转成 HTML 字符串并注入到最终产出的 HTML 中，因此单调地执行 `,s.jsx(i.code,{children:"renderToString"}),` 已经不能满足这个场景了，
你需要自定义这段服务端渲染的逻辑。`]}),`
`,s.jsxs(i.p,{children:["你可以通过在 ",s.jsx(i.code,{children:"src"})," 目录下新建 ",s.jsx(i.code,{children:"server-render.ts"}),` 文件，在这里面默认导出一个渲染函数。
以 `,s.jsx(i.code,{children:"styled-jsx"})," 为例，对应的 SSR 渲染函数如下："]}),`
`,s.jsx(i.pre,{className:"shiki shiki-themes min-light plastic",style:{backgroundColor:"#ffffff","--shiki-dark-bg":"#21252B",color:"#24292eff","--shiki-dark":"#A9B2C3"},tabIndex:"0",children:s.jsxs(i.code,{children:[s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#C2C3C5","--shiki-dark":"#5F6672",fontStyle:"inherit","--shiki-dark-font-style":"italic"},children:"// src/server-render.ts"})}),`
`,s.jsx(i.span,{className:"line"}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"import"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" { "}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"ReactElement"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" } "}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"from"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"react"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:";"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"import"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" { "}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"renderToStaticMarkup"}),s.jsx(i.span,{style:{color:"#212121","--shiki-dark":"#A9B2C3"},children:","}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:" renderToString"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" } "}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"from"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"react-dom/server"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:";"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"import"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" { "}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"createStyleRegistry"}),s.jsx(i.span,{style:{color:"#212121","--shiki-dark":"#A9B2C3"},children:","}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:" StyleRegistry"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" } "}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"from"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"styled-jsx"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:";"})]}),`
`,s.jsx(i.span,{className:"line"}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#C2C3C5","--shiki-dark":"#5F6672",fontStyle:"inherit","--shiki-dark-font-style":"italic"},children:"// 创建样式注册表"})}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#61AFEF"},children:"const"}),s.jsx(i.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:" registry"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:" ="}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:" createStyleRegistry"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"();"})]}),`
`,s.jsx(i.span,{className:"line"}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"export"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:" default"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#61AFEF"},children:" function"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:" render"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"("}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"element"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:":"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#E5C07B"},children:" ReactElement"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:") {"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"  registry"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#A9B2C3"},children:"."}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:"flush"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"();"})]}),`
`,s.jsx(i.span,{className:"line"}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#C2C3C5","--shiki-dark":"#5F6672",fontStyle:"inherit","--shiki-dark-font-style":"italic"},children:"  // 渲染应用 HTML"})}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#61AFEF"},children:"  const"}),s.jsx(i.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:" appHtml"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:" ="}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:" renderToString"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"("})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"    <"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"StyleRegistry"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:" registry"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"="}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"{"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"registry"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"}"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:">"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"{"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"element"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"}"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"</"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"StyleRegistry"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:">"})]}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"  );"})}),`
`,s.jsx(i.span,{className:"line"}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#C2C3C5","--shiki-dark":"#5F6672",fontStyle:"inherit","--shiki-dark-font-style":"italic"},children:"  // 渲染收集到的样式"})}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#61AFEF"},children:"  const"}),s.jsx(i.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:" headTags"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:" ="}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:" renderToStaticMarkup"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"(<>{registry.styles()}"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"</>"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:");"})]}),`
`,s.jsx(i.span,{className:"line"}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"  return"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" {"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"    appHtml"}),s.jsx(i.span,{style:{color:"#212121","--shiki-dark":"#A9B2C3"},children:","})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"    headTags"}),s.jsx(i.span,{style:{color:"#212121","--shiki-dark":"#A9B2C3"},children:","})]}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"  };"})}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"}"})})]})}),`
`,s.jsx(i.p,{children:"如上所示，在默认导出的渲染函数的返回值中："}),`
`,s.jsxs(i.ul,{children:[`
`,s.jsxs(i.li,{children:[s.jsx(i.code,{children:"appHtml"})," 是应用的 HTML 字符串。"]}),`
`,s.jsxs(i.li,{children:[s.jsx(i.code,{children:"headTags"})," 是需要注入到 head 的 HTML 字符串。"]}),`
`]})]})}function o(l={}){const{wrapper:i}={...e(),...l.components};return i?s.jsx(i,{...l,children:s.jsx(r,{...l})}):r(l)}export{o as default,c as frontmatter,d as toc};

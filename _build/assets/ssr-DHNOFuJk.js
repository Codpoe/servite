import{j as s}from"./jsx-runtime-OjB1YB6s.js";import{u as n}from"./index-Crl2ozBJ.js";const h={commitTime:1728965524},o=[{id:"ssr---服务端渲染",text:"SSR - 服务端渲染",depth:1},{id:"介绍",text:"介绍",depth:2},{id:"使用",text:"使用",depth:2},{id:"降级",text:"降级",depth:2},{id:"自动降级",text:"自动降级",depth:3},{id:"主动降级",text:"主动降级",depth:3},{id:"url",text:"URL",depth:4},{id:"header",text:"Header",depth:4},{id:"中间件",text:"中间件",depth:4},{id:"缓存",text:"缓存",depth:2},{id:"修改-ssr-返回的-html",text:"修改 SSR 返回的 HTML",depth:2}];function e(l){const i={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",span:"span",ul:"ul",...n(),...l.components},{Callout:r}=i;return r||a("Callout"),s.jsxs(s.Fragment,{children:[s.jsx(i.h1,{id:"ssr---服务端渲染",children:"SSR - 服务端渲染"}),`
`,s.jsx(i.h2,{id:"介绍",children:"介绍"}),`
`,s.jsx(i.p,{children:`SSR（Server-Side Rendering 服务端渲染）是一种在请求时在服务器上而不是在浏览器中渲染 Web 页面的技术，
这允许 Web 页面在服务器上呈现并作为静态 HTML 发送到客户端。SSR 有很多好处：`}),`
`,s.jsxs(i.ul,{children:[`
`,s.jsx(i.li,{children:"提高性能并提供更好的用户体验。"}),`
`,s.jsx(i.li,{children:"改进 Web 应用的搜索引擎优化（SEO），因为内容已经在服务器上呈现，并且可以很容易地被搜索引擎索引。"}),`
`]}),`
`,s.jsx(i.h2,{id:"使用",children:"使用"}),`
`,s.jsx(i.p,{children:"servite 已经默认开启了 SSR，无需额外配置。"}),`
`,s.jsxs(r,{type:"warning",children:[s.jsx(i.p,{children:"为了让渲染的内容在服务端和客户端保持一致，需要注意以下几点："}),s.jsxs(i.ul,{children:[`
`,s.jsx(i.li,{children:`在编写 class 组件时，避免在构造函数中执行任何副作用操作（如访问浏览器 API、发送网络请求等）。
这些操作只能在生命周期函数或事件回调中执行。`}),`
`,s.jsx(i.li,{children:"同理，在编写函数组件时，避免在函数体中执行任何副作用操作。这些操作只能在使用 hooks（如 useEffect）时执行。"}),`
`,s.jsx(i.li,{children:"在使用 hooks 时，需要确保它们在服务端渲染时不执行副作用操作。这通常需要检查组件的挂载状态。"}),`
`]})]}),`
`,s.jsx(i.h2,{id:"降级",children:"降级"}),`
`,s.jsx(i.p,{children:"当 SSR 出错，或者因为机器性能瓶颈等原因，我们需要将 SSR 降级为 CSR，以提高页面的可用性。"}),`
`,s.jsx(i.h3,{id:"自动降级",children:"自动降级"}),`
`,s.jsx(i.p,{children:"当 SSR 出错时，Servite 会主动降级为 CSR，这无需开发者手动操作。"}),`
`,s.jsx(i.h3,{id:"主动降级",children:"主动降级"}),`
`,s.jsx(i.h4,{id:"url",children:"URL"}),`
`,s.jsxs(i.p,{children:["给页面 URL 添加 ",s.jsx(i.code,{children:"ssr_fallback=1"}),` 参数，可以主动降级为 CSR。
例如，将原始地址 `,s.jsx(i.code,{children:"https://www.xyz.com/pageA"})," 修改为 ",s.jsx(i.code,{children:"http://www.xyz.com/pageA?ssr_fallback=1"}),`，
使降级即时生效。`]}),`
`,s.jsx(i.h4,{id:"header",children:"Header"}),`
`,s.jsxs(i.p,{children:["给页面添加 ",s.jsx(i.code,{children:"x-ssr-fallback: 1"})," 请求头，也可以主动降级为 CSR。"]}),`
`,s.jsx(i.h4,{id:"中间件",children:"中间件"}),`
`,s.jsxs(i.p,{children:["在中间件 onRequest 里可以通过设置 ",s.jsx(i.code,{children:"event.context.ssr = false"})," 在请求处理过程中主动降级为 CSR。"]}),`
`,s.jsx(i.pre,{className:"shiki shiki-themes min-light plastic",style:{backgroundColor:"#ffffff","--shiki-dark-bg":"#21252B",color:"#24292eff","--shiki-dark":"#A9B2C3"},tabIndex:"0",children:s.jsxs(i.code,{children:[s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#C2C3C5","--shiki-dark":"#5F6672",fontStyle:"inherit","--shiki-dark-font-style":"italic"},children:"// src/server/middlewares/<name>.ts"})}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"import"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" { "}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"defineMiddleware"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" } "}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"from"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"servite/runtime/server"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:";"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"import"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:" os"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:" from"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"os"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:";"})]}),`
`,s.jsx(i.span,{className:"line"}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"export"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:" default"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:" defineMiddleware"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"("}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#61AFEF"},children:"async"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" ("}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"event"}),s.jsx(i.span,{style:{color:"#212121","--shiki-dark":"#A9B2C3"},children:","}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:" next"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:") "}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#61AFEF"},children:"=>"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" {"})]}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#C2C3C5","--shiki-dark":"#5F6672",fontStyle:"inherit","--shiki-dark-font-style":"italic"},children:"  // 如果系统负载过高，则主动降级为 CSR"})}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"  if"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" ("}),s.jsx(i.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"event"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"."}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"path"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:" ==="}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"/pageA"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:" &&"}),s.jsx(i.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:" os"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#A9B2C3"},children:"."}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:"loadavg"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"()["}),s.jsx(i.span,{style:{color:"#1976D2","--shiki-dark":"#56B6C2"},children:"0"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"] "}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:">"}),s.jsx(i.span,{style:{color:"#1976D2","--shiki-dark":"#56B6C2"},children:" 1.5"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:") {"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"    event"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"."}),s.jsx(i.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"context"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"."}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"ssr"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:" ="}),s.jsx(i.span,{style:{color:"#1976D2","--shiki-dark":"#56B6C2"},children:" false"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:";"})]}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"  }"})}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"  return"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:" next"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"();"})]}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"});"})})]})}),`
`,s.jsx(i.h2,{id:"缓存",children:"缓存"}),`
`,s.jsx(i.p,{children:"TODO"}),`
`,s.jsx(i.h2,{id:"修改-ssr-返回的-html",children:"修改 SSR 返回的 HTML"}),`
`,s.jsxs(i.p,{children:["在中间件 onRequest 里可以通过 ",s.jsx(i.code,{children:"event.context.html.inject()"})," 方法给 SSR 返回的 HTML 注入标签。"]}),`
`,s.jsx(i.pre,{className:"shiki shiki-themes min-light plastic",style:{backgroundColor:"#ffffff","--shiki-dark-bg":"#21252B",color:"#24292eff","--shiki-dark":"#A9B2C3"},tabIndex:"0",children:s.jsxs(i.code,{children:[s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#C2C3C5","--shiki-dark":"#5F6672",fontStyle:"inherit","--shiki-dark-font-style":"italic"},children:"// src/server/middlewares/<name>.ts"})}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"import"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" { "}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"defineMiddleware"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" } "}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"from"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"servite/runtime/server"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:";"})]}),`
`,s.jsx(i.span,{className:"line"}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"export"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:" default"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:" defineMiddleware"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"("}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#61AFEF"},children:"async"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" ("}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"event"}),s.jsx(i.span,{style:{color:"#212121","--shiki-dark":"#A9B2C3"},children:","}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:" next"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:") "}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#61AFEF"},children:"=>"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" {"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"  if"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" ("}),s.jsx(i.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"event"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"."}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"path"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:" ==="}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"/pageA"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:") {"})]}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#C2C3C5","--shiki-dark":"#5F6672",fontStyle:"inherit","--shiki-dark-font-style":"italic"},children:"    // 给 ssr 返回的 html body 加上额外的 script"})}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"    event"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#A9B2C3"},children:"."}),s.jsx(i.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"context"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#A9B2C3"},children:"."}),s.jsx(i.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"html"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#A9B2C3"},children:"."}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:"inject"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"({"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"      injectTo"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#A9B2C3"},children:":"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"body"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),s.jsx(i.span,{style:{color:"#212121","--shiki-dark":"#A9B2C3"},children:","})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"      tag"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#A9B2C3"},children:":"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"script"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),s.jsx(i.span,{style:{color:"#212121","--shiki-dark":"#A9B2C3"},children:","})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"      attrs"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#A9B2C3"},children:":"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" {"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"        src"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#A9B2C3"},children:":"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"..."}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"})]}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"      }"})}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"    });"})}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"  }"})}),`
`,s.jsx(i.span,{className:"line"}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"  return"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:" next"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"();"})]}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"});"})})]})}),`
`,s.jsxs(i.p,{children:["也可以通过 ",s.jsx(i.code,{children:"event.context.html.addTransformer()"})," 方法修改 SSR 返回的 HTML 内容："]}),`
`,s.jsx(i.pre,{className:"shiki shiki-themes min-light plastic",style:{backgroundColor:"#ffffff","--shiki-dark-bg":"#21252B",color:"#24292eff","--shiki-dark":"#A9B2C3"},tabIndex:"0",children:s.jsxs(i.code,{children:[s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#C2C3C5","--shiki-dark":"#5F6672",fontStyle:"inherit","--shiki-dark-font-style":"italic"},children:"// src/server/middlewares/<name>.ts"})}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"import"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" { "}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"defineMiddleware"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" } "}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"from"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"servite/runtime/server"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:";"})]}),`
`,s.jsx(i.span,{className:"line"}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"export"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:" default"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:" defineMiddleware"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"("}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#61AFEF"},children:"async"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" ("}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"event"}),s.jsx(i.span,{style:{color:"#212121","--shiki-dark":"#A9B2C3"},children:","}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:" next"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:") "}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#61AFEF"},children:"=>"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" {"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"  if"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" ("}),s.jsx(i.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"event"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"."}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"path"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:" ==="}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"/pageA"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:") {"})]}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#C2C3C5","--shiki-dark":"#5F6672",fontStyle:"inherit","--shiki-dark-font-style":"italic"},children:"    // 修改 ssr 返回的 html string"})}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"    event"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#A9B2C3"},children:"."}),s.jsx(i.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"context"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#A9B2C3"},children:"."}),s.jsx(i.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"html"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#A9B2C3"},children:"."}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:"addTransformer"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"("}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"html"}),s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#61AFEF"},children:" =>"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" {"})]}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"      return"}),s.jsx(i.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:" html"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#A9B2C3"},children:"."}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:"replace"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"("}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"<body>"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),s.jsx(i.span,{style:{color:"#212121","--shiki-dark":"#A9B2C3"},children:","}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"<body><div>Hello World</div>"}),s.jsx(i.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:");"})]}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"    });"})}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"  }"})}),`
`,s.jsx(i.span,{className:"line"}),`
`,s.jsxs(i.span,{className:"line",children:[s.jsx(i.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"  return"}),s.jsx(i.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:" next"}),s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"();"})]}),`
`,s.jsx(i.span,{className:"line",children:s.jsx(i.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"});"})})]})}),`
`,s.jsx(r,{type:"warning",children:s.jsx(i.p,{children:`需要注意的是，Servite 使用的是 Streaming SSR，所以上述 html transformer 会被多次调用，即每个 html 分块都会被调用一次 transform，
所以在 transform 函数中修改 html 内容时需要注意避免重复修改。`})})]})}function k(l={}){const{wrapper:i}={...n(),...l.components};return i?s.jsx(i,{...l,children:s.jsx(e,{...l})}):e(l)}function a(l,i){throw new Error("Expected component `"+l+"` to be defined: you likely forgot to import, pass, or provide it.")}export{k as default,h as frontmatter,o as toc};

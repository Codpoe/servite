import{j as i}from"./jsx-runtime-OjB1YB6s.js";import{u as n}from"./index-Crl2ozBJ.js";const h={commitTime:1728478888},o=[{id:"ssr---服务端渲染",text:"SSR - 服务端渲染",depth:1},{id:"介绍",text:"介绍",depth:2},{id:"使用",text:"使用",depth:2},{id:"降级",text:"降级",depth:2},{id:"自动降级",text:"自动降级",depth:3},{id:"主动降级",text:"主动降级",depth:3},{id:"url",text:"URL",depth:4},{id:"header",text:"Header",depth:4},{id:"中间件",text:"中间件",depth:4},{id:"缓存",text:"缓存",depth:2},{id:"修改-ssr-template",text:"修改 SSR template",depth:2},{id:"修改-ssr-返回的-html",text:"修改 SSR 返回的 HTML",depth:2}];function r(l){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",span:"span",ul:"ul",...n(),...l.components},{Callout:e}=s;return e||a("Callout"),i.jsxs(i.Fragment,{children:[i.jsx(s.h1,{id:"ssr---服务端渲染",children:"SSR - 服务端渲染"}),`
`,i.jsx(s.h2,{id:"介绍",children:"介绍"}),`
`,i.jsx(s.p,{children:`SSR（Server-Side Rendering 服务端渲染）是一种在请求时在服务器上而不是在浏览器中渲染 Web 页面的技术，
这允许 Web 页面在服务器上呈现并作为静态 HTML 发送到客户端。SSR 有很多好处：`}),`
`,i.jsxs(s.ul,{children:[`
`,i.jsx(s.li,{children:"提高性能并提供更好的用户体验。"}),`
`,i.jsx(s.li,{children:"改进 Web 应用的搜索引擎优化（SEO），因为内容已经在服务器上呈现，并且可以很容易地被搜索引擎索引。"}),`
`]}),`
`,i.jsx(s.h2,{id:"使用",children:"使用"}),`
`,i.jsx(s.p,{children:"servite 已经默认开启了 SSR，无需额外配置。"}),`
`,i.jsxs(e,{type:"warning",children:[i.jsx(s.p,{children:"为了让渲染的内容在服务端和客户端保持一致，需要注意以下几点："}),i.jsxs(s.ul,{children:[`
`,i.jsx(s.li,{children:`在编写 class 组件时，避免在构造函数中执行任何副作用操作（如访问浏览器 API、发送网络请求等）。
这些操作只能在生命周期函数或事件回调中执行。`}),`
`,i.jsx(s.li,{children:"同理，在编写函数组件时，避免在函数体中执行任何副作用操作。这些操作只能在使用 hooks（如 useEffect）时执行。"}),`
`,i.jsx(s.li,{children:"在使用 hooks 时，需要确保它们在服务端渲染时不执行副作用操作。这通常需要检查组件的挂载状态。"}),`
`]})]}),`
`,i.jsx(s.h2,{id:"降级",children:"降级"}),`
`,i.jsx(s.p,{children:"当 SSR 出错，或者因为机器性能瓶颈等原因，我们需要将 SSR 降级为 CSR，以提高页面的可用性。"}),`
`,i.jsx(s.h3,{id:"自动降级",children:"自动降级"}),`
`,i.jsx(s.p,{children:"当 SSR 出错时，Servite 会主动降级为 CSR，这无需开发者手动操作。"}),`
`,i.jsx(s.h3,{id:"主动降级",children:"主动降级"}),`
`,i.jsx(s.h4,{id:"url",children:"URL"}),`
`,i.jsxs(s.p,{children:["给页面 URL 添加 ",i.jsx(s.code,{children:"ssr_fallback=1"}),` 参数，可以主动降级为 CSR。
例如，将原始地址 `,i.jsx(s.code,{children:"https://www.xyz.com/pageA"})," 修改为 ",i.jsx(s.code,{children:"http://www.xyz.com/pageA?ssr_fallback=1"}),`，
使降级即时生效。`]}),`
`,i.jsx(s.h4,{id:"header",children:"Header"}),`
`,i.jsxs(s.p,{children:["给页面添加 ",i.jsx(s.code,{children:"x-ssr-fallback: 1"})," 请求头，也可以主动降级为 CSR。"]}),`
`,i.jsx(s.h4,{id:"中间件",children:"中间件"}),`
`,i.jsxs(s.p,{children:["在中间件 onRequest 里可以通过设置 ",i.jsx(s.code,{children:"event.context.ssr = false"})," 在请求处理过程中主动降级为 CSR。"]}),`
`,i.jsx(s.pre,{className:"shiki shiki-themes min-light plastic",style:{backgroundColor:"#ffffff","--shiki-dark-bg":"#21252B",color:"#24292eff","--shiki-dark":"#A9B2C3"},tabIndex:"0",children:i.jsxs(s.code,{children:[i.jsx(s.span,{className:"line",children:i.jsx(s.span,{style:{color:"#C2C3C5","--shiki-dark":"#5F6672",fontStyle:"inherit","--shiki-dark-font-style":"italic"},children:"// src/server/middlewares/<name>.ts"})}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"import"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" { "}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"defineMiddleware"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" } "}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"from"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"servite/runtime/server"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:";"})]}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"import"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:" os"}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:" from"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"os"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:";"})]}),`
`,i.jsx(s.span,{className:"line"}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"export"}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:" default"}),i.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:" defineMiddleware"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"("}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#61AFEF"},children:"async"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" ("}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"event"}),i.jsx(s.span,{style:{color:"#212121","--shiki-dark":"#A9B2C3"},children:","}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:" next"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:") "}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#61AFEF"},children:"=>"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" {"})]}),`
`,i.jsx(s.span,{className:"line",children:i.jsx(s.span,{style:{color:"#C2C3C5","--shiki-dark":"#5F6672",fontStyle:"inherit","--shiki-dark-font-style":"italic"},children:"  // 如果系统负载过高，则主动降级为 CSR"})}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"  if"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" ("}),i.jsx(s.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"event"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"."}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"path"}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:" ==="}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"/pageA"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:" &&"}),i.jsx(s.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:" os"}),i.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#A9B2C3"},children:"."}),i.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:"loadavg"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"()["}),i.jsx(s.span,{style:{color:"#1976D2","--shiki-dark":"#56B6C2"},children:"0"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"] "}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:">"}),i.jsx(s.span,{style:{color:"#1976D2","--shiki-dark":"#56B6C2"},children:" 1.5"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:") {"})]}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"    event"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"."}),i.jsx(s.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"context"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"."}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"ssr"}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:" ="}),i.jsx(s.span,{style:{color:"#1976D2","--shiki-dark":"#56B6C2"},children:" false"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:";"})]}),`
`,i.jsx(s.span,{className:"line",children:i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"  }"})}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"  return"}),i.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:" next"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"();"})]}),`
`,i.jsx(s.span,{className:"line",children:i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"});"})})]})}),`
`,i.jsx(s.h2,{id:"缓存",children:"缓存"}),`
`,i.jsx(s.p,{children:"TODO"}),`
`,i.jsx(s.h2,{id:"修改-ssr-template",children:"修改 SSR template"}),`
`,i.jsxs(s.p,{children:["在中间件 onRequest 里可以通过 ",i.jsx(s.code,{children:"event.context.template.inject()"})," 方法给 SSR template 注入 HTML 标签。"]}),`
`,i.jsx(s.pre,{className:"shiki shiki-themes min-light plastic",style:{backgroundColor:"#ffffff","--shiki-dark-bg":"#21252B",color:"#24292eff","--shiki-dark":"#A9B2C3"},tabIndex:"0",children:i.jsxs(s.code,{children:[i.jsx(s.span,{className:"line",children:i.jsx(s.span,{style:{color:"#C2C3C5","--shiki-dark":"#5F6672",fontStyle:"inherit","--shiki-dark-font-style":"italic"},children:"// src/server/middlewares/<name>.ts"})}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"import"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" { "}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"defineMiddleware"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" } "}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"from"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"servite/runtime/server"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:";"})]}),`
`,i.jsx(s.span,{className:"line"}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"export"}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:" default"}),i.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:" defineMiddleware"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"("}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#61AFEF"},children:"async"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" ("}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"event"}),i.jsx(s.span,{style:{color:"#212121","--shiki-dark":"#A9B2C3"},children:","}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:" next"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:") "}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#61AFEF"},children:"=>"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" {"})]}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"  if"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" ("}),i.jsx(s.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"event"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"."}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"path"}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:" ==="}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"/pageA"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:") {"})]}),`
`,i.jsx(s.span,{className:"line",children:i.jsx(s.span,{style:{color:"#C2C3C5","--shiki-dark":"#5F6672",fontStyle:"inherit","--shiki-dark-font-style":"italic"},children:"    // 在 head 顶部插入 meta 标签"})}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"    event"}),i.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#A9B2C3"},children:"."}),i.jsx(s.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"context"}),i.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#A9B2C3"},children:"."}),i.jsx(s.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"template"}),i.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#A9B2C3"},children:"."}),i.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:"inject"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"({"})]}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"      tag"}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#A9B2C3"},children:":"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"meta"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),i.jsx(s.span,{style:{color:"#212121","--shiki-dark":"#A9B2C3"},children:","})]}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"      attrs"}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#A9B2C3"},children:":"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" {"})]}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"        name"}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#A9B2C3"},children:":"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"description"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),i.jsx(s.span,{style:{color:"#212121","--shiki-dark":"#A9B2C3"},children:","})]}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"        content"}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#A9B2C3"},children:":"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"This is a description"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"})]}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"      }"}),i.jsx(s.span,{style:{color:"#212121","--shiki-dark":"#A9B2C3"},children:","})]}),`
`,i.jsx(s.span,{className:"line",children:i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"    });"})}),`
`,i.jsx(s.span,{className:"line",children:i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"  }"})}),`
`,i.jsx(s.span,{className:"line"}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"  return"}),i.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:" next"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"();"})]}),`
`,i.jsx(s.span,{className:"line",children:i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"});"})})]})}),`
`,i.jsx(s.h2,{id:"修改-ssr-返回的-html",children:"修改 SSR 返回的 HTML"}),`
`,i.jsxs(s.p,{children:["在中间件 onRequest 里可以通过 ",i.jsx(s.code,{children:"event.context.html.inject()"})," 方法给 SSR 返回的 HTML 注入标签。"]}),`
`,i.jsx(s.pre,{className:"shiki shiki-themes min-light plastic",style:{backgroundColor:"#ffffff","--shiki-dark-bg":"#21252B",color:"#24292eff","--shiki-dark":"#A9B2C3"},tabIndex:"0",children:i.jsxs(s.code,{children:[i.jsx(s.span,{className:"line",children:i.jsx(s.span,{style:{color:"#C2C3C5","--shiki-dark":"#5F6672",fontStyle:"inherit","--shiki-dark-font-style":"italic"},children:"// src/server/middlewares/<name>.ts"})}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"import"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" { "}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"defineMiddleware"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" } "}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"from"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"servite/runtime/server"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:";"})]}),`
`,i.jsx(s.span,{className:"line"}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"export"}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:" default"}),i.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:" defineMiddleware"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"("}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#61AFEF"},children:"async"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" ("}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"event"}),i.jsx(s.span,{style:{color:"#212121","--shiki-dark":"#A9B2C3"},children:","}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:" next"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:") "}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#61AFEF"},children:"=>"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" {"})]}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"  if"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" ("}),i.jsx(s.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"event"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"."}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"path"}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:" ==="}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"/pageA"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:") {"})]}),`
`,i.jsx(s.span,{className:"line",children:i.jsx(s.span,{style:{color:"#C2C3C5","--shiki-dark":"#5F6672",fontStyle:"inherit","--shiki-dark-font-style":"italic"},children:"    // 给 ssr 返回的 html body 加上额外的 script"})}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"    event"}),i.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#A9B2C3"},children:"."}),i.jsx(s.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"context"}),i.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#A9B2C3"},children:"."}),i.jsx(s.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"html"}),i.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#A9B2C3"},children:"."}),i.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:"inject"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"({"})]}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"      injectTo"}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#A9B2C3"},children:":"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"body"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),i.jsx(s.span,{style:{color:"#212121","--shiki-dark":"#A9B2C3"},children:","})]}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"      tag"}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#A9B2C3"},children:":"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"script"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),i.jsx(s.span,{style:{color:"#212121","--shiki-dark":"#A9B2C3"},children:","})]}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"      attrs"}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#A9B2C3"},children:":"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" {"})]}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"        src"}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#A9B2C3"},children:":"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"..."}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"})]}),`
`,i.jsx(s.span,{className:"line",children:i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"      }"})}),`
`,i.jsx(s.span,{className:"line",children:i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"    });"})}),`
`,i.jsx(s.span,{className:"line",children:i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"  }"})}),`
`,i.jsx(s.span,{className:"line"}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"  return"}),i.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:" next"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"();"})]}),`
`,i.jsx(s.span,{className:"line",children:i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"});"})})]})}),`
`,i.jsxs(s.p,{children:["也可以通过 ",i.jsx(s.code,{children:"event.context.html.addTransformer()"})," 方法修改 SSR 返回的 HTML 内容："]}),`
`,i.jsx(s.pre,{className:"shiki shiki-themes min-light plastic",style:{backgroundColor:"#ffffff","--shiki-dark-bg":"#21252B",color:"#24292eff","--shiki-dark":"#A9B2C3"},tabIndex:"0",children:i.jsxs(s.code,{children:[i.jsx(s.span,{className:"line",children:i.jsx(s.span,{style:{color:"#C2C3C5","--shiki-dark":"#5F6672",fontStyle:"inherit","--shiki-dark-font-style":"italic"},children:"// src/server/middlewares/<name>.ts"})}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"import"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" { "}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"defineMiddleware"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" } "}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"from"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"servite/runtime/server"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:";"})]}),`
`,i.jsx(s.span,{className:"line"}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"export"}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:" default"}),i.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:" defineMiddleware"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"("}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#61AFEF"},children:"async"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" ("}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"event"}),i.jsx(s.span,{style:{color:"#212121","--shiki-dark":"#A9B2C3"},children:","}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:" next"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:") "}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#61AFEF"},children:"=>"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" {"})]}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"  if"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" ("}),i.jsx(s.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"event"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"."}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"path"}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:" ==="}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"/pageA"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:") {"})]}),`
`,i.jsx(s.span,{className:"line",children:i.jsx(s.span,{style:{color:"#C2C3C5","--shiki-dark":"#5F6672",fontStyle:"inherit","--shiki-dark-font-style":"italic"},children:"    // 修改 ssr 返回的 html string"})}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"    event"}),i.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#A9B2C3"},children:"."}),i.jsx(s.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"context"}),i.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#A9B2C3"},children:"."}),i.jsx(s.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:"html"}),i.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#A9B2C3"},children:"."}),i.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:"addTransformer"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"("}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#C6CCD7"},children:"html"}),i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#61AFEF"},children:" =>"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:" {"})]}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"      return"}),i.jsx(s.span,{style:{color:"#1976D2","--shiki-dark":"#C6CCD7"},children:" html"}),i.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#A9B2C3"},children:"."}),i.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:"replace"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"("}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"<body>"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),i.jsx(s.span,{style:{color:"#212121","--shiki-dark":"#A9B2C3"},children:","}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:" '"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#98C379"},children:"<body><div>Hello World</div>"}),i.jsx(s.span,{style:{color:"#22863A","--shiki-dark":"#A9B2C3"},children:"'"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:");"})]}),`
`,i.jsx(s.span,{className:"line",children:i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"    });"})}),`
`,i.jsx(s.span,{className:"line",children:i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"  }"})}),`
`,i.jsx(s.span,{className:"line"}),`
`,i.jsxs(s.span,{className:"line",children:[i.jsx(s.span,{style:{color:"#D32F2F","--shiki-dark":"#E06C75"},children:"  return"}),i.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#B57EDC"},children:" next"}),i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"();"})]}),`
`,i.jsx(s.span,{className:"line",children:i.jsx(s.span,{style:{color:"#24292EFF","--shiki-dark":"#A9B2C3"},children:"});"})})]})})]})}function k(l={}){const{wrapper:s}={...n(),...l.components};return s?i.jsx(s,{...l,children:i.jsx(r,{...l})}):r(l)}function a(l,s){throw new Error("Expected component `"+l+"` to be defined: you likely forgot to import, pass, or provide it.")}export{k as default,h as frontmatter,o as toc};

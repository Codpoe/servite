import{u as r,j as s}from"./index-BSjnrSkm.js";const o={commitTime:1712220645};function n(e){const l={a:"a",code:"code",h1:"h1",li:"li",p:"p",pre:"pre",span:"span",ul:"ul",...r(),...e.components};return s.jsxs(s.Fragment,{children:[s.jsxs(l.h1,{id:"自定义服务端渲染",children:[s.jsx(l.a,{className:"header-anchor","aria-hidden":"true",tabIndex:"-1",href:"#自定义服务端渲染",children:"#"}),"自定义服务端渲染"]}),`
`,s.jsxs(l.p,{children:["默认情况下，servite 会直接调用 React 的 ",s.jsx(l.code,{children:"renderToString"}),` 方法来渲染应用，
这已经能适配很多场景了。然而如果你使用了 `,s.jsx(l.code,{children:"styled-jsx"})," 或 ",s.jsx(l.code,{children:"styled-components"}),` 之类的
CSS-in-JS 样式方案，一般这些方案都会提供特定的工具让你在 SSR 时收集样式，然后将这些样式
转成 HTML 字符串并注入到最终产出的 HTML 中，因此单调地执行 `,s.jsx(l.code,{children:"renderToString"}),` 已经不能满足这个场景了，
你需要自定义这段服务端渲染的逻辑。`]}),`
`,s.jsxs(l.p,{children:["你可以通过在 ",s.jsx(l.code,{children:"src"})," 目录下新建 ",s.jsx(l.code,{children:"server-render.ts"}),` 文件，在这里面默认导出一个渲染函数。
以 `,s.jsx(l.code,{children:"styled-jsx"})," 为例，对应的 SSR 渲染函数如下："]}),`
`,s.jsx(l.pre,{className:"code-theme-light",style:{backgroundColor:'#f6f8fa" tabindex="0'},children:s.jsxs(l.code,{children:[s.jsx(l.span,{className:"line",children:s.jsx(l.span,{style:{color:"#6A737D"},children:"// src/server-render.ts"})}),`
`,s.jsx(l.span,{className:"line"}),`
`,s.jsxs(l.span,{className:"line",children:[s.jsx(l.span,{style:{color:"#D73A49"},children:"import"}),s.jsx(l.span,{style:{color:"#24292E"},children:" { ReactElement } "}),s.jsx(l.span,{style:{color:"#D73A49"},children:"from"}),s.jsx(l.span,{style:{color:"#24292E"},children:" "}),s.jsx(l.span,{style:{color:"#032F62"},children:"'react'"}),s.jsx(l.span,{style:{color:"#24292E"},children:";"})]}),`
`,s.jsxs(l.span,{className:"line",children:[s.jsx(l.span,{style:{color:"#D73A49"},children:"import"}),s.jsx(l.span,{style:{color:"#24292E"},children:" { renderToStaticMarkup, renderToString } "}),s.jsx(l.span,{style:{color:"#D73A49"},children:"from"}),s.jsx(l.span,{style:{color:"#24292E"},children:" "}),s.jsx(l.span,{style:{color:"#032F62"},children:"'react-dom/server'"}),s.jsx(l.span,{style:{color:"#24292E"},children:";"})]}),`
`,s.jsxs(l.span,{className:"line",children:[s.jsx(l.span,{style:{color:"#D73A49"},children:"import"}),s.jsx(l.span,{style:{color:"#24292E"},children:" { createStyleRegistry, StyleRegistry } "}),s.jsx(l.span,{style:{color:"#D73A49"},children:"from"}),s.jsx(l.span,{style:{color:"#24292E"},children:" "}),s.jsx(l.span,{style:{color:"#032F62"},children:"'styled-jsx'"}),s.jsx(l.span,{style:{color:"#24292E"},children:";"})]}),`
`,s.jsx(l.span,{className:"line"}),`
`,s.jsx(l.span,{className:"line",children:s.jsx(l.span,{style:{color:"#6A737D"},children:"// 创建样式注册表"})}),`
`,s.jsxs(l.span,{className:"line",children:[s.jsx(l.span,{style:{color:"#D73A49"},children:"const"}),s.jsx(l.span,{style:{color:"#24292E"},children:" "}),s.jsx(l.span,{style:{color:"#005CC5"},children:"registry"}),s.jsx(l.span,{style:{color:"#24292E"},children:" "}),s.jsx(l.span,{style:{color:"#D73A49"},children:"="}),s.jsx(l.span,{style:{color:"#24292E"},children:" "}),s.jsx(l.span,{style:{color:"#6F42C1"},children:"createStyleRegistry"}),s.jsx(l.span,{style:{color:"#24292E"},children:"();"})]}),`
`,s.jsx(l.span,{className:"line"}),`
`,s.jsxs(l.span,{className:"line",children:[s.jsx(l.span,{style:{color:"#D73A49"},children:"export"}),s.jsx(l.span,{style:{color:"#24292E"},children:" "}),s.jsx(l.span,{style:{color:"#D73A49"},children:"default"}),s.jsx(l.span,{style:{color:"#24292E"},children:" "}),s.jsx(l.span,{style:{color:"#D73A49"},children:"function"}),s.jsx(l.span,{style:{color:"#24292E"},children:" "}),s.jsx(l.span,{style:{color:"#6F42C1"},children:"render"}),s.jsx(l.span,{style:{color:"#24292E"},children:"("}),s.jsx(l.span,{style:{color:"#E36209"},children:"element"}),s.jsx(l.span,{style:{color:"#D73A49"},children:":"}),s.jsx(l.span,{style:{color:"#24292E"},children:" "}),s.jsx(l.span,{style:{color:"#6F42C1"},children:"ReactElement"}),s.jsx(l.span,{style:{color:"#24292E"},children:") {"})]}),`
`,s.jsxs(l.span,{className:"line",children:[s.jsx(l.span,{style:{color:"#24292E"},children:"  registry."}),s.jsx(l.span,{style:{color:"#6F42C1"},children:"flush"}),s.jsx(l.span,{style:{color:"#24292E"},children:"();"})]}),`
`,s.jsx(l.span,{className:"line"}),`
`,s.jsxs(l.span,{className:"line",children:[s.jsx(l.span,{style:{color:"#24292E"},children:"  "}),s.jsx(l.span,{style:{color:"#6A737D"},children:"// 渲染应用 HTML"})]}),`
`,s.jsxs(l.span,{className:"line",children:[s.jsx(l.span,{style:{color:"#24292E"},children:"  "}),s.jsx(l.span,{style:{color:"#D73A49"},children:"const"}),s.jsx(l.span,{style:{color:"#24292E"},children:" "}),s.jsx(l.span,{style:{color:"#005CC5"},children:"appHtml"}),s.jsx(l.span,{style:{color:"#24292E"},children:" "}),s.jsx(l.span,{style:{color:"#D73A49"},children:"="}),s.jsx(l.span,{style:{color:"#24292E"},children:" "}),s.jsx(l.span,{style:{color:"#6F42C1"},children:"renderToString"}),s.jsx(l.span,{style:{color:"#24292E"},children:"("})]}),`
`,s.jsxs(l.span,{className:"line",children:[s.jsx(l.span,{style:{color:"#24292E"},children:"    "}),s.jsx(l.span,{style:{color:"#D73A49"},children:"<"}),s.jsx(l.span,{style:{color:"#24292E"},children:"StyleRegistry registry"}),s.jsx(l.span,{style:{color:"#D73A49"},children:"="}),s.jsx(l.span,{style:{color:"#24292E"},children:"{registry}"}),s.jsx(l.span,{style:{color:"#D73A49"},children:">"}),s.jsx(l.span,{style:{color:"#24292E"},children:"{element}"}),s.jsx(l.span,{style:{color:"#D73A49"},children:"</"}),s.jsx(l.span,{style:{color:"#24292E"},children:"StyleRegistry"}),s.jsx(l.span,{style:{color:"#D73A49"},children:">"})]}),`
`,s.jsx(l.span,{className:"line",children:s.jsx(l.span,{style:{color:"#24292E"},children:"  );"})}),`
`,s.jsx(l.span,{className:"line"}),`
`,s.jsxs(l.span,{className:"line",children:[s.jsx(l.span,{style:{color:"#24292E"},children:"  "}),s.jsx(l.span,{style:{color:"#6A737D"},children:"// 渲染收集到的样式"})]}),`
`,s.jsxs(l.span,{className:"line",children:[s.jsx(l.span,{style:{color:"#24292E"},children:"  "}),s.jsx(l.span,{style:{color:"#D73A49"},children:"const"}),s.jsx(l.span,{style:{color:"#24292E"},children:" "}),s.jsx(l.span,{style:{color:"#005CC5"},children:"headTags"}),s.jsx(l.span,{style:{color:"#24292E"},children:" "}),s.jsx(l.span,{style:{color:"#D73A49"},children:"="}),s.jsx(l.span,{style:{color:"#24292E"},children:" "}),s.jsx(l.span,{style:{color:"#6F42C1"},children:"renderToStaticMarkup"}),s.jsx(l.span,{style:{color:"#24292E"},children:"(<>{registry.styles()}"}),s.jsx(l.span,{style:{color:"#D73A49"},children:"</>"}),s.jsx(l.span,{style:{color:"#24292E"},children:");"})]}),`
`,s.jsx(l.span,{className:"line"}),`
`,s.jsxs(l.span,{className:"line",children:[s.jsx(l.span,{style:{color:"#24292E"},children:"  "}),s.jsx(l.span,{style:{color:"#D73A49"},children:"return"}),s.jsx(l.span,{style:{color:"#24292E"},children:" {"})]}),`
`,s.jsx(l.span,{className:"line",children:s.jsx(l.span,{style:{color:"#24292E"},children:"    appHtml,"})}),`
`,s.jsx(l.span,{className:"line",children:s.jsx(l.span,{style:{color:"#24292E"},children:"    headTags,"})}),`
`,s.jsx(l.span,{className:"line",children:s.jsx(l.span,{style:{color:"#24292E"},children:"  };"})}),`
`,s.jsx(l.span,{className:"line",children:s.jsx(l.span,{style:{color:"#24292E"},children:"}"})})]})}),s.jsx(l.pre,{className:"code-theme-dark",style:{backgroundColor:'#161b22" tabindex="0'},children:s.jsxs(l.code,{children:[s.jsx(l.span,{className:"line",children:s.jsx(l.span,{style:{color:"#6A737D"},children:"// src/server-render.ts"})}),`
`,s.jsx(l.span,{className:"line"}),`
`,s.jsxs(l.span,{className:"line",children:[s.jsx(l.span,{style:{color:"#F97583"},children:"import"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:" { ReactElement } "}),s.jsx(l.span,{style:{color:"#F97583"},children:"from"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:" "}),s.jsx(l.span,{style:{color:"#9ECBFF"},children:"'react'"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:";"})]}),`
`,s.jsxs(l.span,{className:"line",children:[s.jsx(l.span,{style:{color:"#F97583"},children:"import"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:" { renderToStaticMarkup, renderToString } "}),s.jsx(l.span,{style:{color:"#F97583"},children:"from"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:" "}),s.jsx(l.span,{style:{color:"#9ECBFF"},children:"'react-dom/server'"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:";"})]}),`
`,s.jsxs(l.span,{className:"line",children:[s.jsx(l.span,{style:{color:"#F97583"},children:"import"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:" { createStyleRegistry, StyleRegistry } "}),s.jsx(l.span,{style:{color:"#F97583"},children:"from"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:" "}),s.jsx(l.span,{style:{color:"#9ECBFF"},children:"'styled-jsx'"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:";"})]}),`
`,s.jsx(l.span,{className:"line"}),`
`,s.jsx(l.span,{className:"line",children:s.jsx(l.span,{style:{color:"#6A737D"},children:"// 创建样式注册表"})}),`
`,s.jsxs(l.span,{className:"line",children:[s.jsx(l.span,{style:{color:"#F97583"},children:"const"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:" "}),s.jsx(l.span,{style:{color:"#79B8FF"},children:"registry"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:" "}),s.jsx(l.span,{style:{color:"#F97583"},children:"="}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:" "}),s.jsx(l.span,{style:{color:"#B392F0"},children:"createStyleRegistry"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:"();"})]}),`
`,s.jsx(l.span,{className:"line"}),`
`,s.jsxs(l.span,{className:"line",children:[s.jsx(l.span,{style:{color:"#F97583"},children:"export"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:" "}),s.jsx(l.span,{style:{color:"#F97583"},children:"default"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:" "}),s.jsx(l.span,{style:{color:"#F97583"},children:"function"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:" "}),s.jsx(l.span,{style:{color:"#B392F0"},children:"render"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:"("}),s.jsx(l.span,{style:{color:"#FFAB70"},children:"element"}),s.jsx(l.span,{style:{color:"#F97583"},children:":"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:" "}),s.jsx(l.span,{style:{color:"#B392F0"},children:"ReactElement"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:") {"})]}),`
`,s.jsxs(l.span,{className:"line",children:[s.jsx(l.span,{style:{color:"#E1E4E8"},children:"  registry."}),s.jsx(l.span,{style:{color:"#B392F0"},children:"flush"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:"();"})]}),`
`,s.jsx(l.span,{className:"line"}),`
`,s.jsxs(l.span,{className:"line",children:[s.jsx(l.span,{style:{color:"#E1E4E8"},children:"  "}),s.jsx(l.span,{style:{color:"#6A737D"},children:"// 渲染应用 HTML"})]}),`
`,s.jsxs(l.span,{className:"line",children:[s.jsx(l.span,{style:{color:"#E1E4E8"},children:"  "}),s.jsx(l.span,{style:{color:"#F97583"},children:"const"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:" "}),s.jsx(l.span,{style:{color:"#79B8FF"},children:"appHtml"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:" "}),s.jsx(l.span,{style:{color:"#F97583"},children:"="}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:" "}),s.jsx(l.span,{style:{color:"#B392F0"},children:"renderToString"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:"("})]}),`
`,s.jsxs(l.span,{className:"line",children:[s.jsx(l.span,{style:{color:"#E1E4E8"},children:"    "}),s.jsx(l.span,{style:{color:"#F97583"},children:"<"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:"StyleRegistry registry"}),s.jsx(l.span,{style:{color:"#F97583"},children:"="}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:"{registry}"}),s.jsx(l.span,{style:{color:"#F97583"},children:">"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:"{element}"}),s.jsx(l.span,{style:{color:"#F97583"},children:"</"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:"StyleRegistry"}),s.jsx(l.span,{style:{color:"#F97583"},children:">"})]}),`
`,s.jsx(l.span,{className:"line",children:s.jsx(l.span,{style:{color:"#E1E4E8"},children:"  );"})}),`
`,s.jsx(l.span,{className:"line"}),`
`,s.jsxs(l.span,{className:"line",children:[s.jsx(l.span,{style:{color:"#E1E4E8"},children:"  "}),s.jsx(l.span,{style:{color:"#6A737D"},children:"// 渲染收集到的样式"})]}),`
`,s.jsxs(l.span,{className:"line",children:[s.jsx(l.span,{style:{color:"#E1E4E8"},children:"  "}),s.jsx(l.span,{style:{color:"#F97583"},children:"const"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:" "}),s.jsx(l.span,{style:{color:"#79B8FF"},children:"headTags"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:" "}),s.jsx(l.span,{style:{color:"#F97583"},children:"="}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:" "}),s.jsx(l.span,{style:{color:"#B392F0"},children:"renderToStaticMarkup"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:"(<>{registry.styles()}"}),s.jsx(l.span,{style:{color:"#F97583"},children:"</>"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:");"})]}),`
`,s.jsx(l.span,{className:"line"}),`
`,s.jsxs(l.span,{className:"line",children:[s.jsx(l.span,{style:{color:"#E1E4E8"},children:"  "}),s.jsx(l.span,{style:{color:"#F97583"},children:"return"}),s.jsx(l.span,{style:{color:"#E1E4E8"},children:" {"})]}),`
`,s.jsx(l.span,{className:"line",children:s.jsx(l.span,{style:{color:"#E1E4E8"},children:"    appHtml,"})}),`
`,s.jsx(l.span,{className:"line",children:s.jsx(l.span,{style:{color:"#E1E4E8"},children:"    headTags,"})}),`
`,s.jsx(l.span,{className:"line",children:s.jsx(l.span,{style:{color:"#E1E4E8"},children:"  };"})}),`
`,s.jsx(l.span,{className:"line",children:s.jsx(l.span,{style:{color:"#E1E4E8"},children:"}"})})]})}),`
`,s.jsx(l.p,{children:"如上所示，在默认导出的渲染函数的返回值中："}),`
`,s.jsxs(l.ul,{children:[`
`,s.jsxs(l.li,{children:[s.jsx(l.code,{children:"appHtml"})," 是应用的 HTML 字符串。"]}),`
`,s.jsxs(l.li,{children:[s.jsx(l.code,{children:"headTags"})," 是需要注入到 head 的 HTML 字符串。"]}),`
`]})]})}function a(e={}){const{wrapper:l}={...r(),...e.components};return l?s.jsx(l,{...e,children:s.jsx(n,{...e})}):n(e)}export{a as default,o as frontmatter};

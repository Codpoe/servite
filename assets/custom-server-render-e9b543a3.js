import{u as c,j as e,a as n,F as o}from"./index-34016108.js";const i=void 0;function r(s){const l=Object.assign({h1:"h1",a:"a",p:"p",code:"code",pre:"pre",span:"span",ul:"ul",li:"li"},c(),s.components);return n(o,{children:[n(l.h1,{id:"自定义服务端渲染",children:[e(l.a,{className:"header-anchor","aria-hidden":"true",tabIndex:"-1",href:"#自定义服务端渲染",children:"#"}),"自定义服务端渲染"]}),`
`,n(l.p,{children:["默认情况下，servite 会直接调用 React 的 ",e(l.code,{children:"renderToString"}),` 方法来渲染应用，
这已经能适配很多场景了。然而如果你使用了 `,e(l.code,{children:"styled-jsx"})," 或 ",e(l.code,{children:"styled-components"}),` 之类的
CSS-in-JS 样式方案，一般这些方案都会提供特定的工具让你在 SSR 时收集样式，然后将这些样式
转成 HTML 字符串并注入到最终产出的 HTML 中，因此单调地执行 `,e(l.code,{children:"renderToString"}),` 已经不能满足这个场景了，
你需要自定义这段服务端渲染的逻辑。`]}),`
`,n(l.p,{children:["你可以通过在 ",e(l.code,{children:"src"})," 目录下新建 ",e(l.code,{children:"server-render.ts"}),` 文件，在这里面默认导出一个渲染函数。
以 `,e(l.code,{children:"styled-jsx"})," 为例，对应的 SSR 渲染函数如下："]}),`
`,e(l.pre,{className:"code-theme-light",style:{backgroundColor:"#f6f8fa"},children:n(l.code,{children:[e(l.span,{className:"line",children:e(l.span,{style:{color:"#6E7781"},children:"// src/server-render.ts"})}),`
`,e(l.span,{className:"line"}),`
`,n(l.span,{className:"line",children:[e(l.span,{style:{color:"#CF222E"},children:"import"}),e(l.span,{style:{color:"#24292F"},children:" { ReactElement } "}),e(l.span,{style:{color:"#CF222E"},children:"from"}),e(l.span,{style:{color:"#24292F"},children:" "}),e(l.span,{style:{color:"#0A3069"},children:"'react'"}),e(l.span,{style:{color:"#24292F"},children:";"})]}),`
`,n(l.span,{className:"line",children:[e(l.span,{style:{color:"#CF222E"},children:"import"}),e(l.span,{style:{color:"#24292F"},children:" { renderToStaticMarkup, renderToString } "}),e(l.span,{style:{color:"#CF222E"},children:"from"}),e(l.span,{style:{color:"#24292F"},children:" "}),e(l.span,{style:{color:"#0A3069"},children:"'react-dom/server'"}),e(l.span,{style:{color:"#24292F"},children:";"})]}),`
`,n(l.span,{className:"line",children:[e(l.span,{style:{color:"#CF222E"},children:"import"}),e(l.span,{style:{color:"#24292F"},children:" { createStyleRegistry, StyleRegistry } "}),e(l.span,{style:{color:"#CF222E"},children:"from"}),e(l.span,{style:{color:"#24292F"},children:" "}),e(l.span,{style:{color:"#0A3069"},children:"'styled-jsx'"}),e(l.span,{style:{color:"#24292F"},children:";"})]}),`
`,e(l.span,{className:"line"}),`
`,e(l.span,{className:"line",children:e(l.span,{style:{color:"#6E7781"},children:"// 创建样式注册表"})}),`
`,n(l.span,{className:"line",children:[e(l.span,{style:{color:"#CF222E"},children:"const"}),e(l.span,{style:{color:"#24292F"},children:" "}),e(l.span,{style:{color:"#0550AE"},children:"registry"}),e(l.span,{style:{color:"#24292F"},children:" "}),e(l.span,{style:{color:"#CF222E"},children:"="}),e(l.span,{style:{color:"#24292F"},children:" "}),e(l.span,{style:{color:"#8250DF"},children:"createStyleRegistry"}),e(l.span,{style:{color:"#24292F"},children:"();"})]}),`
`,e(l.span,{className:"line"}),`
`,n(l.span,{className:"line",children:[e(l.span,{style:{color:"#CF222E"},children:"export"}),e(l.span,{style:{color:"#953800"},children:" "}),e(l.span,{style:{color:"#CF222E"},children:"default"}),e(l.span,{style:{color:"#953800"},children:" "}),e(l.span,{style:{color:"#CF222E"},children:"function"}),e(l.span,{style:{color:"#953800"},children:" "}),e(l.span,{style:{color:"#8250DF"},children:"render"}),e(l.span,{style:{color:"#953800"},children:"(element"}),e(l.span,{style:{color:"#CF222E"},children:":"}),e(l.span,{style:{color:"#953800"},children:" ReactElement) "}),e(l.span,{style:{color:"#24292F"},children:"{"})]}),`
`,n(l.span,{className:"line",children:[e(l.span,{style:{color:"#24292F"},children:"  registry."}),e(l.span,{style:{color:"#8250DF"},children:"flush"}),e(l.span,{style:{color:"#24292F"},children:"();"})]}),`
`,e(l.span,{className:"line"}),`
`,n(l.span,{className:"line",children:[e(l.span,{style:{color:"#24292F"},children:"  "}),e(l.span,{style:{color:"#6E7781"},children:"// 渲染应用 HTML"})]}),`
`,n(l.span,{className:"line",children:[e(l.span,{style:{color:"#24292F"},children:"  "}),e(l.span,{style:{color:"#CF222E"},children:"const"}),e(l.span,{style:{color:"#24292F"},children:" "}),e(l.span,{style:{color:"#0550AE"},children:"appHtml"}),e(l.span,{style:{color:"#24292F"},children:" "}),e(l.span,{style:{color:"#CF222E"},children:"="}),e(l.span,{style:{color:"#24292F"},children:" "}),e(l.span,{style:{color:"#8250DF"},children:"renderToString"}),e(l.span,{style:{color:"#24292F"},children:"("})]}),`
`,n(l.span,{className:"line",children:[e(l.span,{style:{color:"#24292F"},children:"    "}),e(l.span,{style:{color:"#CF222E"},children:"<"}),e(l.span,{style:{color:"#24292F"},children:"StyleRegistry registry"}),e(l.span,{style:{color:"#CF222E"},children:"="}),e(l.span,{style:{color:"#24292F"},children:"{registry}"}),e(l.span,{style:{color:"#CF222E"},children:">"}),e(l.span,{style:{color:"#24292F"},children:"{element}"}),e(l.span,{style:{color:"#CF222E"},children:"</"}),e(l.span,{style:{color:"#24292F"},children:"StyleRegistry"}),e(l.span,{style:{color:"#CF222E"},children:">"})]}),`
`,e(l.span,{className:"line",children:e(l.span,{style:{color:"#24292F"},children:"  );"})}),`
`,e(l.span,{className:"line"}),`
`,n(l.span,{className:"line",children:[e(l.span,{style:{color:"#24292F"},children:"  "}),e(l.span,{style:{color:"#6E7781"},children:"// 渲染收集到的样式"})]}),`
`,n(l.span,{className:"line",children:[e(l.span,{style:{color:"#24292F"},children:"  "}),e(l.span,{style:{color:"#CF222E"},children:"const"}),e(l.span,{style:{color:"#24292F"},children:" "}),e(l.span,{style:{color:"#0550AE"},children:"headTags"}),e(l.span,{style:{color:"#24292F"},children:" "}),e(l.span,{style:{color:"#CF222E"},children:"="}),e(l.span,{style:{color:"#24292F"},children:" "}),e(l.span,{style:{color:"#8250DF"},children:"renderToStaticMarkup"}),e(l.span,{style:{color:"#24292F"},children:"(<>{registry.styles()}"}),e(l.span,{style:{color:"#CF222E"},children:"</>"}),e(l.span,{style:{color:"#24292F"},children:");"})]}),`
`,e(l.span,{className:"line"}),`
`,n(l.span,{className:"line",children:[e(l.span,{style:{color:"#24292F"},children:"  "}),e(l.span,{style:{color:"#CF222E"},children:"return"}),e(l.span,{style:{color:"#24292F"},children:" {"})]}),`
`,e(l.span,{className:"line",children:e(l.span,{style:{color:"#24292F"},children:"    appHtml,"})}),`
`,e(l.span,{className:"line",children:e(l.span,{style:{color:"#24292F"},children:"    headTags,"})}),`
`,e(l.span,{className:"line",children:e(l.span,{style:{color:"#24292F"},children:"  };"})}),`
`,e(l.span,{className:"line",children:e(l.span,{style:{color:"#24292F"},children:"}"})})]})}),e(l.pre,{className:"code-theme-dark",style:{backgroundColor:"#161b22"},children:n(l.code,{children:[e(l.span,{className:"line",children:e(l.span,{style:{color:"#8B949E"},children:"// src/server-render.ts"})}),`
`,e(l.span,{className:"line"}),`
`,n(l.span,{className:"line",children:[e(l.span,{style:{color:"#FF7B72"},children:"import"}),e(l.span,{style:{color:"#C9D1D9"},children:" { ReactElement } "}),e(l.span,{style:{color:"#FF7B72"},children:"from"}),e(l.span,{style:{color:"#C9D1D9"},children:" "}),e(l.span,{style:{color:"#A5D6FF"},children:"'react'"}),e(l.span,{style:{color:"#C9D1D9"},children:";"})]}),`
`,n(l.span,{className:"line",children:[e(l.span,{style:{color:"#FF7B72"},children:"import"}),e(l.span,{style:{color:"#C9D1D9"},children:" { renderToStaticMarkup, renderToString } "}),e(l.span,{style:{color:"#FF7B72"},children:"from"}),e(l.span,{style:{color:"#C9D1D9"},children:" "}),e(l.span,{style:{color:"#A5D6FF"},children:"'react-dom/server'"}),e(l.span,{style:{color:"#C9D1D9"},children:";"})]}),`
`,n(l.span,{className:"line",children:[e(l.span,{style:{color:"#FF7B72"},children:"import"}),e(l.span,{style:{color:"#C9D1D9"},children:" { createStyleRegistry, StyleRegistry } "}),e(l.span,{style:{color:"#FF7B72"},children:"from"}),e(l.span,{style:{color:"#C9D1D9"},children:" "}),e(l.span,{style:{color:"#A5D6FF"},children:"'styled-jsx'"}),e(l.span,{style:{color:"#C9D1D9"},children:";"})]}),`
`,e(l.span,{className:"line"}),`
`,e(l.span,{className:"line",children:e(l.span,{style:{color:"#8B949E"},children:"// 创建样式注册表"})}),`
`,n(l.span,{className:"line",children:[e(l.span,{style:{color:"#FF7B72"},children:"const"}),e(l.span,{style:{color:"#C9D1D9"},children:" "}),e(l.span,{style:{color:"#79C0FF"},children:"registry"}),e(l.span,{style:{color:"#C9D1D9"},children:" "}),e(l.span,{style:{color:"#FF7B72"},children:"="}),e(l.span,{style:{color:"#C9D1D9"},children:" "}),e(l.span,{style:{color:"#D2A8FF"},children:"createStyleRegistry"}),e(l.span,{style:{color:"#C9D1D9"},children:"();"})]}),`
`,e(l.span,{className:"line"}),`
`,n(l.span,{className:"line",children:[e(l.span,{style:{color:"#FF7B72"},children:"export"}),e(l.span,{style:{color:"#FFA657"},children:" "}),e(l.span,{style:{color:"#FF7B72"},children:"default"}),e(l.span,{style:{color:"#FFA657"},children:" "}),e(l.span,{style:{color:"#FF7B72"},children:"function"}),e(l.span,{style:{color:"#FFA657"},children:" "}),e(l.span,{style:{color:"#D2A8FF"},children:"render"}),e(l.span,{style:{color:"#FFA657"},children:"(element"}),e(l.span,{style:{color:"#FF7B72"},children:":"}),e(l.span,{style:{color:"#FFA657"},children:" ReactElement) "}),e(l.span,{style:{color:"#C9D1D9"},children:"{"})]}),`
`,n(l.span,{className:"line",children:[e(l.span,{style:{color:"#C9D1D9"},children:"  registry."}),e(l.span,{style:{color:"#D2A8FF"},children:"flush"}),e(l.span,{style:{color:"#C9D1D9"},children:"();"})]}),`
`,e(l.span,{className:"line"}),`
`,n(l.span,{className:"line",children:[e(l.span,{style:{color:"#C9D1D9"},children:"  "}),e(l.span,{style:{color:"#8B949E"},children:"// 渲染应用 HTML"})]}),`
`,n(l.span,{className:"line",children:[e(l.span,{style:{color:"#C9D1D9"},children:"  "}),e(l.span,{style:{color:"#FF7B72"},children:"const"}),e(l.span,{style:{color:"#C9D1D9"},children:" "}),e(l.span,{style:{color:"#79C0FF"},children:"appHtml"}),e(l.span,{style:{color:"#C9D1D9"},children:" "}),e(l.span,{style:{color:"#FF7B72"},children:"="}),e(l.span,{style:{color:"#C9D1D9"},children:" "}),e(l.span,{style:{color:"#D2A8FF"},children:"renderToString"}),e(l.span,{style:{color:"#C9D1D9"},children:"("})]}),`
`,n(l.span,{className:"line",children:[e(l.span,{style:{color:"#C9D1D9"},children:"    "}),e(l.span,{style:{color:"#FF7B72"},children:"<"}),e(l.span,{style:{color:"#C9D1D9"},children:"StyleRegistry registry"}),e(l.span,{style:{color:"#FF7B72"},children:"="}),e(l.span,{style:{color:"#C9D1D9"},children:"{registry}"}),e(l.span,{style:{color:"#FF7B72"},children:">"}),e(l.span,{style:{color:"#C9D1D9"},children:"{element}"}),e(l.span,{style:{color:"#FF7B72"},children:"</"}),e(l.span,{style:{color:"#C9D1D9"},children:"StyleRegistry"}),e(l.span,{style:{color:"#FF7B72"},children:">"})]}),`
`,e(l.span,{className:"line",children:e(l.span,{style:{color:"#C9D1D9"},children:"  );"})}),`
`,e(l.span,{className:"line"}),`
`,n(l.span,{className:"line",children:[e(l.span,{style:{color:"#C9D1D9"},children:"  "}),e(l.span,{style:{color:"#8B949E"},children:"// 渲染收集到的样式"})]}),`
`,n(l.span,{className:"line",children:[e(l.span,{style:{color:"#C9D1D9"},children:"  "}),e(l.span,{style:{color:"#FF7B72"},children:"const"}),e(l.span,{style:{color:"#C9D1D9"},children:" "}),e(l.span,{style:{color:"#79C0FF"},children:"headTags"}),e(l.span,{style:{color:"#C9D1D9"},children:" "}),e(l.span,{style:{color:"#FF7B72"},children:"="}),e(l.span,{style:{color:"#C9D1D9"},children:" "}),e(l.span,{style:{color:"#D2A8FF"},children:"renderToStaticMarkup"}),e(l.span,{style:{color:"#C9D1D9"},children:"(<>{registry.styles()}"}),e(l.span,{style:{color:"#FF7B72"},children:"</>"}),e(l.span,{style:{color:"#C9D1D9"},children:");"})]}),`
`,e(l.span,{className:"line"}),`
`,n(l.span,{className:"line",children:[e(l.span,{style:{color:"#C9D1D9"},children:"  "}),e(l.span,{style:{color:"#FF7B72"},children:"return"}),e(l.span,{style:{color:"#C9D1D9"},children:" {"})]}),`
`,e(l.span,{className:"line",children:e(l.span,{style:{color:"#C9D1D9"},children:"    appHtml,"})}),`
`,e(l.span,{className:"line",children:e(l.span,{style:{color:"#C9D1D9"},children:"    headTags,"})}),`
`,e(l.span,{className:"line",children:e(l.span,{style:{color:"#C9D1D9"},children:"  };"})}),`
`,e(l.span,{className:"line",children:e(l.span,{style:{color:"#C9D1D9"},children:"}"})})]})}),`
`,e(l.p,{children:"如上所示，在默认导出的渲染函数的返回值中："}),`
`,n(l.ul,{children:[`
`,n(l.li,{children:[e(l.code,{children:"appHtml"})," 是应用的 HTML 字符串。"]}),`
`,n(l.li,{children:[e(l.code,{children:"headTags"})," 是需要注入到 head 的 HTML 字符串。"]}),`
`]})]})}function t(s={}){const{wrapper:l}=Object.assign({},c(),s.components);return l?e(l,Object.assign({},s,{children:e(r,s)})):r(s)}export{t as default,i as meta};
